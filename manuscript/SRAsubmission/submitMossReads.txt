## let's get the reads from the moss project onto SRA

## a sort-of recent example on how to do this is here, on the laptop:

## on laptop:
vim -M /home/daniel/Documents/analyses/graham/grass-endophyte-community/SRAsubmission/submitGrahamReads.txt

## on officeComp
vim -M /home/daniel/Documents/projects/grass-endophyte-community/SRAsubmission/submitGrahamReads.txt

## this was bioproject PRJNA1160472
## https://www.ncbi.nlm.nih.gov/bioproject/PRJNA1160472

## most basic question - what are we submitting?

## 1,2 - raw, passed reads from both sequencing runs
## 3 - finished nifH and 16s sequences 

## raw passing reads are where? 

## on the nanopore computer: 

cd /media/vol1/daniel/rawDataNanopore/NostocColonyPCRsRound2/OGZygodonHylocomiumHomalia/OGZygodonHylocomiumHomalia_baseCalled/duplexTrial/trimmed

## these have been demultiplexed. 
## the barcodes we need are:

barcode  9 16S Amblystegium 
barcode 10 16S Homalia
barcode 11 16S Zygodon
barcode 12 NifH OG Hylocomium
barcode 13 NifH OG Zygodon
barcode 14 NifH Homalia

## corresponding files are:

2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_SQK-RBK114-24_barcode09.fastq
2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_SQK-RBK114-24_barcode10.fastq
2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_SQK-RBK114-24_barcode11.fastq
2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_SQK-RBK114-24_barcode12.fastq
2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_SQK-RBK114-24_barcode13.fastq
2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_SQK-RBK114-24_barcode14.fastq

## get these on the laptop:

trimmedDemuxedReadDir=/media/vol1/daniel/rawDataNanopore/NostocColonyPCRsRound2/OGZygodonHylocomiumHomalia/OGZygodonHylocomiumHomalia_baseCalled/duplexTrial/trimmed
putHere=/home/daniel/Documents/projects/mossCyanobacteria/culturingCyanos/nanoporeNostoc16sAlignments/reads2upload2SRA
for i in ${trimmedDemuxedReadDir}/2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_SQK-RBK114-24_barcode{09..14}.fastq; do
  rsync -auv test@132.180.112.115:$i $putHere
done

## we also need OG hylocomium reads - these are here:

getFile=/media/vol1/daniel/nostoc/minionReadsNostoc/allNostoc2.fasta
putHere=/home/daniel/Documents/projects/mossCyanobacteria/culturingCyanos/nanoporeNostoc16sAlignments/reads2upload2SRA
rsync -auv test@132.180.112.115:$getFile $putHere

## let's rename these accordingly:

for i in *barcode??.fastq; do
  mv $i ${i##2ed2dc90-9ec6-43dc-b1a6-362b75c1ab18_}
done

mv allNostoc2.fasta 16S_Hylocomium.fastq
mv SQK-RBK114-24_barcode09.fastq SQK-RBK114-24_barcode09_16S_Amblystegium.fastq 
mv SQK-RBK114-24_barcode10.fastq SQK-RBK114-24_barcode10_16S_Homalia.fastq 
mv SQK-RBK114-24_barcode11.fastq SQK-RBK114-24_barcode11_16S_Zygodon.fastq 
mv SQK-RBK114-24_barcode12.fastq SQK-RBK114-24_barcode12_NifH_Hylocomium.fastq
mv SQK-RBK114-24_barcode13.fastq SQK-RBK114-24_barcode13_NifH_Zygodon.fastq
mv SQK-RBK114-24_barcode14.fastq SQK-RBK114-24_barcode14_NifH_Homalia.fastq

## moved these out of the github repo:
cd /home/daniel/Documents/projects/mossCyanobacteria/culturingCyanos/reads2upload2SRA

## zip them all:
gzip *

## okay, renamed. That's the easy part...

## get our credentials from the SRA site by requesting a new submission folder

ftp -i ftp-private.ncbi.nlm.nih.gov

open ftp-private.ncbi.nlm.nih.gov

subftp

CrasHeshyevVafivgud2

cd uploads/danchurchthomas_gmail.com_VxAdPqLf

#mkdir nostocRawReads

cd nostocRawReads

mput  *fastq.gz

## I think that succeeded. Now we need to send the metadata to NCBI...

## using the NCBI SRA submission page (log in first):
https://submit.ncbi.nlm.nih.gov/subs/sra/SUB15915318/

## there were three associated files before...sample sheet, metadata sheet, and project info sheet

## sample-sheet. Things have changed a bit. My old templates don't quite work. 
## We'll try using "Package MIMARKS: specimen, plant-associated; version 6.0"
## definitions:
## https://genomicsstandardsconsortium.github.io/mixs/term_list/
## https://www.ncbi.nlm.nih.gov/biosample/docs/attributes/

## this looks very similar but not exactly like the old sample sheet, as per:
vim -M /home/daniel/Documents/projects/grass-endophyte-community/SRAsubmission/sampleSheet.tsv

## these are the fields I'll use:
*sample_name - different for each, 
sample_title - needed?
bioproject_accession - no bioproject yet
*organism - Nostoc or Compactonostoc
*collection_date - varies 
*env_broad_scale - "temperate broadleaf forest biome" or "temperate coniferous forest biome"
*env_local_scale - "temperate deciduous broadleaf forest" or "temperate evergreen needleleaf forest" 
*env_medium - "understory" for hylocomium, "forest canopy" for others
*geo_loc_name - varies, table 1 
*host - "Hylocomium splendens", etc
*isol_growth_condt - give doi for the rippka paper with BG110: doi: 10.1099/00221287-111-1-1
*lat_lon - use table 1, is already in correct format.
biotic_relationship - "Symbiosis with host moss, possible mutualism"
elev -table 1
host_life_stage "gametophyte"
host_taxid - look up on NCBI

## metadata file...

## our files are:
16S_Hylocomium.fastq.gz
SQK-RBK114-24_barcode09_16S_Amblystegium.fastq.gz
SQK-RBK114-24_barcode10_16S_Homalia.fastq.gz
SQK-RBK114-24_barcode11_16S_Zygodon.fastq.gz
SQK-RBK114-24_barcode12_NifH_Hylocomium.fastq.gz
SQK-RBK114-24_barcode13_NifH_Zygodon.fastq.gz
SQK-RBK114-24_barcode14_NifH_Homalia.fastq.gz

## and raw reads submitted.
## we have an official NCBI bioproject number:

BioProject: 1401537
PRJNA1401537

## now onto genbank and the consensus sequences.
Hylocomium-associated Nostoc 16S
Homalia-associated Nostoc 16S
Zygodon-associated Compactonostoc 16S

MUSCLE (5.1.linux64)

SSU-ALIGN, CyanoSeq database 
0.1.1

Moss on bark of Fagus sylvatica

Scaling up by looking closer: extending the range of moss-Nostoc symbioses deeper into central Europe and to new moss hosts in the forest canopy

Martin Feulner 
Ulla Spieleder
Frederic J. P. Dose
Jona Motzkus
Daniel C. Thomas

doi: https://doi.org/10.64898/2025.12.22.695964 

should have the following modifiers:

Fwd-Primer-Name
Rev-Primer-Name
BioProject 
Latitude-Longitude
Isolation-Source
Host

HMMER 3.3

## strains for these:
OG_hylo
OG_Amblystegium
OG_Homalia
OG_Zygodon

###############
organism="Nostoc sp."
mol_type="genomic DNA"
strain="OG_hylo"
isolation_source="Moss host from forest floor"
host="Hylocomium splendens"
db_xref="taxon:1180"
geo_loc_name="Germany: Bayern, Zell, Waldstein im Fichtelgebirge"
lat_lon="50.14233 N 11.86628 E"
collection_date="May-2023"
note="PCR_primers=fwd_name: 27F, rev_seq: 1492r"
###############



###############
organism="Nostoc sp."
mol_type="genomic DNA"
strain="OG_Homalia"
isolation_source="Moss on bark of Fagus sylvatica"
host="Homalia trichomanoides"
db_xref="taxon:1180"
geo_loc_name="Germany: Bayern, Schwarzachklamm bei steinach"
lat_lon="49.352118 N 11.232484 E"
collection_date="May-2025"
note="PCR_primers=fwd_name: 27F, rev_name: 1492R"
###############


############
organism="Nostoc sp."
mol_type="genomic DNA"
strain="OG_Zygodon"
isolation_source="Moss on bark of Sorbus sp."
host="Zygodon rupestris"
db_xref="taxon:1180"
geo_loc_name="Germany: Bayern, Pfaffenberg bei Mettendorf"
lat_lon="49.02075 N 11.35922 E"
collection_date="Nov-2024"
note="PCR_primers=fwd_name: 27F, rev_name: 1492R"
###############



organism="Nostoc sp."
mol_type="genomic DNA"
strain="OG_Amblystegium"
isolation_source="Moss on bark of Sorbus sp."
host="Pseudoamblystegium subtile"
db_xref="taxon:1180"
geo_loc_name="Germany: Bayern, Pfaffenberg bei
ettendorf"
collection_date="Nov-2024"
note="PCR_primers=fwd_name: 27F, rev_name: 1492R"
###############

## we need to relabel the definition line:

cd /home/daniel/Documents/projects/mossSymbiosis/nostoc/manuscript/genbankSeqSubmission/nifH/

## so for Hylocomium nifH sequence 

vim Hylocomium_nostoc_BC12_nifH.fa

>Seq1 [organism=Carpodacus mexicanus] [clone=6b] actin (act) mRNA, partial cds

## I think each definition in our fasta, should look something like this:

## for hylocomium:

collection_date="May-2023"
note="PCR_primers=fwd_name: 27F, rev_seq: 1492r"

>Seq1
[organism=Nostoc sp.]
[strain=OG_hylo]
[BioProject=PRJNA1401537]
[Latitude-Longitude=50.14233 N 11.86628 E]
[Isolation-Source=Moss host from forest floor]
[Host=Hylocomium splendens]
[geo_loc_name="Germany: Bayern, Zell, Waldstein im Fichtelgebirge"]
[collection_date="May-2023"]
Nostoc sp. nitrogenase component II (nifH) gene, partial cds

## in one line:
>Seq1 [organism=Nostoc sp.] [strain=OG_hylo] [BioProject=PRJNA1401537] [Latitude-Longitude=50.14233 N 11.86628 E] [Isolation-Source=Moss host from forest floor] [Host=Hylocomium splendens] [geo_loc_name="Germany: Bayern, Zell, Waldstein im Fichtelgebirge"] [collection_date="Nov-2023"] Nostoc sp. nitrogenase component II (nifH) gene, partial cds

## add this as a definition line to the files to be submitted to genbank

mv Hylocomium_nostoc_BC12_nifH.fa Hylocomium_nostoc_nifH.fa 

## turns out we need to provide information about the coding region, possibly in the
## form of an amino acid file, or at listing the coding regions manually. 

## I think the proper name for the protein coded for by nifH is:
Dinitrogen reductase (EC 1.18.6.1)

## ugh. We're just using the barcode...why do we need to do all this?

## problem, not sure where the start codon for the nifH gene is 
## looks like the primers are inside of the stop and start codons.

## run some translations, maybe emboss toolkit as per Dimitri recommends?:

nifDir="/home/daniel/Documents/projects/mossSymbiosis/nostoc/manuscript/genbankSeqSubmission/nifH/"

sudo apt install emboss

transeq -sequence ${nifDir}Hylocomium_nostoc_nifH.fa -frame=6  -outseq "hyloNifH.faa"

## and if we have a multi-fasta?
transeq -sequence ${nifDir}Homalia_nostoc_BC14_nifH.fa -frame=6  -outseq "homaliaNifH.faa"

transeq -sequence ${nifDir}Zygodon_nostoc_BC13_nifH.fa -frame=6  -outseq "zygodonNifH.faa"

## assembly program
MUSCLE (5.1.linux64)
HMMER 3.3

## feature info:
Dinitrogen reductase
Component II or Fe protein of nitrogenase
1.18.6.1
nifH is the structural gene for nitrogenase reductase.

Nostoc sp.

## for Hylocomium. Reading frame 1:
LKADSTRLMLHSKAQTSVLHLAAERGAVEDIELEEVMLTGFRDVRCVESGGPEPGVGCAGRGIITAINFLEENGAYKDVDFVSYDVLGDVVCGGFAMPIREGKA

## for homalia:
## homalia clade 1, Reading frame 3 seems most likely:
A*TWCRLPGRGIITAINFLEENGAYSDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSGEM
## even though it has a stop codon it? but the ntide sequence seems mostly correct. 
## trim the sequence.

## homalia clade 2, Reading frame 1:
ADSTRLMLHSKAQTSVLQLAAERGAVEDIELEEVMLTGFRDVRCVESGGPEPGVGCAGRGIITAINFLEENGAYKDVDFVSYDVLGDVVCGGFAMPIREGKAQESTSLPLVK

## homalia clade 3, Reading frame 2:
SKAQTTVLHLAAERGAVEDIEIEEVMLKGFRDVLCVESGGPEPGVGCAGRGIITAINFLEENGAYQNLDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSVX

## for zygodon:
## zygodon clade1, reading frame 1:
KADSTRLILHCKAQTTVLHLAAERGAVEDIELEEVVITGFRDIRCVESGGPEPGVGCAGRGIITAINFLEENGAYSDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSX

## zygodon clade2, reading frame 1:
KADSTRLMLHSKAQTSVLQLAAERGAVEDIELEEVMLTGFRDVRCVESGGPEPGVGCAGRGIITAINFLEENGAYKDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSX

## zygodon clade3, reading frame 3:
ADSTRLMLHSKAQTTVLHLAAERGAVEDIEIEEVMLTGFRNVRCVESGGPEPGVGCAGRGIITAINFLEENGAYQDLDFVSYDVLGDVVCGGFAMPIREGKAQV

## the portion of the read causing the problem homalia clade 1, Reading frame 3 is here:
                                                  A*TWCRLP GRGIITAINFLEENGAYSDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSGEM
LKADSTRLMLHSKAQTSVLHLAAERGAVEDIELEEVMLTGFRDVRCVESGGPEPGVGCAGRGIITAINFLEENGAYKDVDFVSYDVLGDVVCGGFAMPIREGKA
 KADSTRLMLHSKAQTSVLQLAAERGAVEDIELEEVMLTGFRDVRCVESGGPEPGVGCAGRGIITAINFLEENGAYKDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSX
  ADSTRLMLHSKAQTTVLHLAAERGAVEDIEIEEVMLTGFRNVRCVESGGPEPGVGCAGRGIITAINFLEENGAYQDLDFVSYDVLGDVVCGGFAMPIREGKAQV

## is there any other reason to throw this front sequence away?
## most of the other available sequences have a G at position 23. 

## if this is replaced, how does this affect our AA sequence?
GTGCCTGAACCTGGTGTAGGTTGC C CGGTCGCGGTATTATCACCGCCATCAACTTCCTCGAAGAAAACGGCGCTTACTCAGATGTAGATTTCGTATCCTACGACGTGTTGGGTGACGTTGTGTGCGGTGGTTTCGCTATGCCAATCCGTGAAGGTAAAGCCCAAGAAATCTACATCGTTACCTCCGGTGAAATG

A*TWCRLP GRGIITAINFLEENGAYSDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSGEM

vim testGsubHomaliaClade1.fa

>testGsubHomaliaClade1
GTGCCTGAACCTGGTGTAGGTTGC G CGGTCGCGGTATTATCACCGCCATCAACTTCCTCGAAGAAAACGGCGCTTACTCAGATGTAGATTTCGTATCCTACGACGTGTTGGGTGACGTTGTGTGCGGTGGTTTCGCTATGCCAATCCGTGAAGGTAAAGCCCAAGAAATCTACATCGTTACCTCCGGTGAAATG

transeq -sequence testGsubHomaliaClade1.fa -frame=6  -outseq "testGsubHomaliaClade1.faa"

cat testGsubHomaliaClade1.fa 
cat testGsubHomaliaClade1.faa

## nope, doesn't help.

## I think this is the only problematic sequence. 
## I don't know where the error is, but it makes sense that this would happen in the 
## Homalia sequences, we had far fewer reads to work with. 
## Much more likely we picked up an error. 

## the part that makes sense: 
vvvvvvvv 
A*TWCRLP GRGIITAINFLEENGAYSDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSGEM

## trim to that. 

## that would mean this on the nucleotide side:
    A   *   T   W   C   R   L   P   G
GT GCC TGA ACC TGG TGT AGG TTG CCC GGT CGCGGTATTATCACCGCCATCAACTTCCTCGAAGAAAACGGCGCTTACTCAGATGTAGATTTCGTATCCTACGACGTGTTGGGTGACGTTGTGTGCGGTGGTTTCGCTATGCCAATCCGTGAAGGTAAAGCCCAAGAAATCTACATCGTTACCTCCGGTGAAATG

## which gives us our new sequence:
GRGIITAINFLEENGAYSDVDFVSYDVLGDVVCGGFAMPIREGKAQEIYIVTSGEM

GGTCGCGGTATTATCACCGCCATCAACTTCCTCGAAGAAAACGGCGCTTACTCAGATGTAGATTTCGTATCCTACGACGTGTTGGGTGACGTTGTGTGCGGTGGTTTCGCTATGCCAATCCGTGAAGGTAAAGCCCAAGAAATCTACATCGTTACCTCCGGTGAAATG

## so to upload these...break them up into individual fastas? 

## oops, for Homolia trichomanoides clade1, I think I mixed up the collection date. Should be May 2025, not May 2023. Email?


